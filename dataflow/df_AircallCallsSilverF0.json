{
	"name": "df_AircallCallsSilverF0",
	"properties": {
		"folder": {
			"name": "SilverF0"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "ds_adsl_json",
						"type": "DatasetReference"
					},
					"name": "sourceAircallBronze"
				}
			],
			"sinks": [
				{
					"linkedService": {
						"referenceName": "ls_adsl",
						"type": "LinkedServiceReference"
					},
					"name": "sinkAircallSilver"
				}
			],
			"transformations": [
				{
					"name": "flattenCalls"
				},
				{
					"name": "select1",
					"description": "quitado porque array comments, tags teams y assigne_To, number, transferred_by, transferred_to, user porque json"
				},
				{
					"name": "derivedColumn1"
				},
				{
					"name": "alterRow1"
				}
			],
			"scriptLines": [
				"source(output(",
				"          calls as (answered_at as integer, archived as boolean, asset as string, assigned_to as (availability_status as string, available as boolean, created_at as string, direct_link as string, email as string, id as integer, language as string, name as string, state as string, time_zone as string, wrap_up_time as boolean), comments as (content as string, id as integer, posted_at as integer, posted_by as (availability_status as string, available as boolean, created_at as string, direct_link as string, email as string, id as integer, language as string, name as string, state as string, time_zone as string, wrap_up_time as boolean))[], contact as string, cost as double, country_code_a2 as string, direct_link as string, direction as string, duration as short, ended_at as integer, id as long, missed_call_reason as string, number as (availability_status as string, country as string, created_at as string, digits as string, direct_link as string, id as integer, is_ivr as boolean, live_recording_activated as boolean, messages as (after_hours as string, callback_later as string, closed as string, ivr as string, ringing_tone as string, unanswered_call as string, voicemail as string, waiting as string, welcome as string), name as string, open as boolean, priority as string, time_zone as string), pricing_type as string, raw_digits as string, recording as string, recording_short_url as string, sid as string, started_at as integer, status as string, tags as (created_at as integer, id as integer, name as string, tagged_by as (availability_status as string, available as boolean, created_at as string, direct_link as string, email as string, id as integer, language as string, name as string, state as string, time_zone as string, wrap_up_time as boolean))[], teams as (created_at as string, direct_link as string, id as integer, name as string)[], transferred_by as (authentication_token as string, company_id as integer, created_at as string, custom_price as string, custom_twilio_edge as string, custom_twilio_jitter_buffer_size as string, custom_twilio_region as string, default_out_number_id as integer, default_prefix as string, deleted_at as string, email as string, first_name as string, id as integer, intercom_android_hash as string, intercom_hash as string, is_admin as boolean, is_onboarded_for_teams_in_numbers as boolean, is_onboarded_on_app as boolean, language as string, last_name as string, marked_for_deletion as boolean, migrated_on_authentication_manager as boolean, onboarding_step as boolean, phone_numbers_count as boolean, picture_url as string, ring_timeout as short, state as string, time_zone as string, unavailable_until as string, updated_at as string, use_aircall_phonenumber_as_callerid as boolean, use_mobile_incoming_calls as string, use_react_phone as boolean, wrap_up_time as boolean), transferred_to as (availability_status as string, available as boolean, created_at as string, direct_link as string, email as string, id as integer, language as string, name as string, state as string, time_zone as string, wrap_up_time as boolean), user as (availability_status as string, available as boolean, created_at as string, direct_link as string, email as string, id as integer, language as string, name as string, state as string, time_zone as string, wrap_up_time as boolean), voicemail as string, voicemail_short_url as string)[],",
				"          meta as (count as short, current_page as short, next_page_link as string, per_page as short, previous_page_link as string, total as short)",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     rowUrlColumn: 'filepath',",
				"     documentForm: 'documentPerLine') ~> sourceAircallBronze",
				"sourceAircallBronze foldDown(unroll(calls),",
				"     mapColumn(",
				"          answered_at = calls.answered_at,",
				"          archived = calls.archived,",
				"          asset = calls.asset,",
				"          assigned_to = calls.assigned_to,",
				"          assigned_to_availability_status = calls.assigned_to.availability_status,",
				"          assigned_to_available = calls.assigned_to.available,",
				"          assigned_to_created_at = calls.assigned_to.created_at,",
				"          assigned_to_direct_link = calls.assigned_to.direct_link,",
				"          assigned_to_email = calls.assigned_to.email,",
				"          assigned_to_id = calls.assigned_to.id,",
				"          assigned_to_language = calls.assigned_to.language,",
				"          assigned_to_name = calls.assigned_to.name,",
				"          assigned_to_state = calls.assigned_to.state,",
				"          assigned_to_time_zone = calls.assigned_to.time_zone,",
				"          assigned_to_wrap_up_time = calls.assigned_to.wrap_up_time,",
				"          comments = calls.comments,",
				"          contact = calls.contact,",
				"          cost = calls.cost,",
				"          country_code_a2 = calls.country_code_a2,",
				"          direct_link = calls.direct_link,",
				"          direction = calls.direction,",
				"          duration = calls.duration,",
				"          ended_at = calls.ended_at,",
				"          id = calls.id,",
				"          missed_call_reason = calls.missed_call_reason,",
				"          number = calls.number,",
				"          number_availability_status = calls.number.availability_status,",
				"          number_country = calls.number.country,",
				"          number_created_at = calls.number.created_at,",
				"          number_digits = calls.number.digits,",
				"          number_direct_link = calls.number.direct_link,",
				"          number_id = calls.number.id,",
				"          number_is_ivr = calls.number.is_ivr,",
				"          number_live_recording_activated = calls.number.live_recording_activated,",
				"          number_name = calls.number.name,",
				"          number_open = calls.number.open,",
				"          number_priority = calls.number.priority,",
				"          number_time_zone = calls.number.time_zone,",
				"          number_msg_after_hours = calls.number.messages.after_hours,",
				"          number_msg_callback_later = calls.number.messages.callback_later,",
				"          number_msg_closed = calls.number.messages.closed,",
				"          number_msg_ivr = calls.number.messages.ivr,",
				"          number_msg_ringing_tone = calls.number.messages.ringing_tone,",
				"          number_msg_unanswered_call = calls.number.messages.unanswered_call,",
				"          number_msg_voicemail = calls.number.messages.voicemail,",
				"          number_msg_waiting = calls.number.messages.waiting,",
				"          number_msg_welcome = calls.number.messages.welcome,",
				"          pricing_type = calls.pricing_type,",
				"          raw_digits = calls.raw_digits,",
				"          recording = calls.recording,",
				"          recording_short_url = calls.recording_short_url,",
				"          sid = calls.sid,",
				"          started_at = calls.started_at,",
				"          status = calls.status,",
				"          tags = calls.tags,",
				"          teams = calls.teams,",
				"          transferred_by = calls.transferred_by,",
				"          transferred_by_authentication_token = calls.transferred_by.authentication_token,",
				"          transferred_by_company_id = calls.transferred_by.company_id,",
				"          transferred_by_created_at = calls.transferred_by.created_at,",
				"          transferred_by_custom_price = calls.transferred_by.custom_price,",
				"          transferred_by_custom_twilio_edge = calls.transferred_by.custom_twilio_edge,",
				"          transferred_by_custom_twilio_jitter_buffer_size = calls.transferred_by.custom_twilio_jitter_buffer_size,",
				"          transferred_by_custom_twilio_region = calls.transferred_by.custom_twilio_region,",
				"          transferred_by_default_out_number_id = calls.transferred_by.default_out_number_id,",
				"          transferred_by_default_prefix = calls.transferred_by.default_prefix,",
				"          transferred_by_deleted_at = calls.transferred_by.deleted_at,",
				"          transferred_by_email = calls.transferred_by.email,",
				"          transferred_by_first_name = calls.transferred_by.first_name,",
				"          transferred_by_id = calls.transferred_by.id,",
				"          transferred_by_intercom_android_hash = calls.transferred_by.intercom_android_hash,",
				"          transferred_by_intercom_hash = calls.transferred_by.intercom_hash,",
				"          transferred_by_is_admin = calls.transferred_by.is_admin,",
				"          transferred_by_is_onboarded_for_teams_in_numbers = calls.transferred_by.is_onboarded_for_teams_in_numbers,",
				"          transferred_by_is_onboarded_on_app = calls.transferred_by.is_onboarded_on_app,",
				"          transferred_by_language = calls.transferred_by.language,",
				"          transferred_by_last_name = calls.transferred_by.last_name,",
				"          transferred_by_marked_for_deletion = calls.transferred_by.marked_for_deletion,",
				"          transferred_by_migrated_on_authentication_manager = calls.transferred_by.migrated_on_authentication_manager,",
				"          transferred_by_onboarding_step = calls.transferred_by.onboarding_step,",
				"          transferred_by_phone_numbers_count = calls.transferred_by.phone_numbers_count,",
				"          transferred_by_picture_url = calls.transferred_by.picture_url,",
				"          transferred_by_ring_timeout = calls.transferred_by.ring_timeout,",
				"          transferred_by_state = calls.transferred_by.state,",
				"          transferred_by_time_zone = calls.transferred_by.time_zone,",
				"          transferred_by_unavailable_until = calls.transferred_by.unavailable_until,",
				"          transferred_by_updated_at = calls.transferred_by.updated_at,",
				"          transferred_by_use_aircall_phonenumber_as_callerid = calls.transferred_by.use_aircall_phonenumber_as_callerid,",
				"          transferred_by_use_mobile_incoming_calls = calls.transferred_by.use_mobile_incoming_calls,",
				"          transferred_by_use_react_phone = calls.transferred_by.use_react_phone,",
				"          transferred_by_wrap_up_time = calls.transferred_by.wrap_up_time,",
				"          transferred_to = calls.transferred_to,",
				"          transferred_to_availability_status = calls.transferred_to.availability_status,",
				"          transferred_to_available = calls.transferred_to.available,",
				"          transferred_to_created_at = calls.transferred_to.created_at,",
				"          transferred_to_direct_link = calls.transferred_to.direct_link,",
				"          transferred_to_email = calls.transferred_to.email,",
				"          transferred_to_id = calls.transferred_to.id,",
				"          transferred_to_language = calls.transferred_to.language,",
				"          transferred_to_name = calls.transferred_to.name,",
				"          transferred_to_state = calls.transferred_to.state,",
				"          transferred_to_time_zone = calls.transferred_to.time_zone,",
				"          transferred_to_wrap_up_time = calls.transferred_to.wrap_up_time,",
				"          user = calls.user,",
				"          user_availability_status = calls.user.availability_status,",
				"          user_available = calls.user.available,",
				"          user_created_at = calls.user.created_at,",
				"          user_direct_link = calls.user.direct_link,",
				"          user_email = calls.user.email,",
				"          user_id = calls.user.id,",
				"          user_language = calls.user.language,",
				"          user_name = calls.user.name,",
				"          user_state = calls.user.state,",
				"          user_time_zone = calls.user.time_zone,",
				"          user_wrap_up_time = calls.user.wrap_up_time,",
				"          voicemail = calls.voicemail,",
				"          voicemail_short_url = calls.voicemail_short_url,",
				"          filepath",
				"     ),",
				"     partitionBy('hash', 1),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: false) ~> flattenCalls",
				"flattenCalls select(mapColumn(",
				"          answered_at,",
				"          archived,",
				"          asset,",
				"          assigned_to_availability_status,",
				"          assigned_to_available,",
				"          assigned_to_created_at,",
				"          assigned_to_direct_link,",
				"          assigned_to_email,",
				"          assigned_to_id,",
				"          assigned_to_language,",
				"          assigned_to_name,",
				"          assigned_to_state,",
				"          assigned_to_time_zone,",
				"          assigned_to_wrap_up_time,",
				"          contact,",
				"          cost,",
				"          country_code_a2,",
				"          direct_link,",
				"          direction,",
				"          duration,",
				"          ended_at,",
				"          id,",
				"          missed_call_reason,",
				"          number_availability_status,",
				"          number_country,",
				"          number_created_at,",
				"          number_digits,",
				"          number_direct_link,",
				"          number_id,",
				"          number_is_ivr,",
				"          number_live_recording_activated,",
				"          number_name,",
				"          number_open,",
				"          number_priority,",
				"          number_time_zone,",
				"          number_msg_after_hours,",
				"          number_msg_callback_later,",
				"          number_msg_closed,",
				"          number_msg_ivr,",
				"          number_msg_ringing_tone,",
				"          number_msg_unanswered_call,",
				"          number_msg_voicemail,",
				"          number_msg_waiting,",
				"          number_msg_welcome,",
				"          pricing_type,",
				"          raw_digits,",
				"          recording,",
				"          recording_short_url,",
				"          sid,",
				"          started_at,",
				"          status,",
				"          transferred_by_authentication_token,",
				"          transferred_by_company_id,",
				"          transferred_by_created_at,",
				"          transferred_by_custom_price,",
				"          transferred_by_custom_twilio_edge,",
				"          transferred_by_custom_twilio_jitter_buffer_size,",
				"          transferred_by_custom_twilio_region,",
				"          transferred_by_default_out_number_id,",
				"          transferred_by_default_prefix,",
				"          transferred_by_deleted_at,",
				"          transferred_by_email,",
				"          transferred_by_first_name,",
				"          transferred_by_id,",
				"          transferred_by_intercom_android_hash,",
				"          transferred_by_intercom_hash,",
				"          transferred_by_is_admin,",
				"          transferred_by_is_onboarded_for_teams_in_numbers,",
				"          transferred_by_is_onboarded_on_app,",
				"          transferred_by_language,",
				"          transferred_by_last_name,",
				"          transferred_by_marked_for_deletion,",
				"          transferred_by_migrated_on_authentication_manager,",
				"          transferred_by_onboarding_step,",
				"          transferred_by_phone_numbers_count,",
				"          transferred_by_picture_url,",
				"          transferred_by_ring_timeout,",
				"          transferred_by_state,",
				"          transferred_by_time_zone,",
				"          transferred_by_unavailable_until,",
				"          transferred_by_updated_at,",
				"          transferred_by_use_aircall_phonenumber_as_callerid,",
				"          transferred_by_use_mobile_incoming_calls,",
				"          transferred_by_use_react_phone,",
				"          transferred_by_wrap_up_time,",
				"          transferred_to_availability_status,",
				"          transferred_to_available,",
				"          transferred_to_created_at,",
				"          transferred_to_direct_link,",
				"          transferred_to_email,",
				"          transferred_to_id,",
				"          transferred_to_language,",
				"          transferred_to_name,",
				"          transferred_to_state,",
				"          transferred_to_time_zone,",
				"          transferred_to_wrap_up_time,",
				"          user_availability_status,",
				"          user_available,",
				"          user_created_at,",
				"          user_direct_link,",
				"          user_email,",
				"          user_id,",
				"          user_language,",
				"          user_name,",
				"          user_state,",
				"          user_time_zone,",
				"          user_wrap_up_time,",
				"          voicemail,",
				"          voicemail_short_url,",
				"          filepath",
				"     ),",
				"     partitionBy('hash', 1),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"select1 derive(started_at = toTimestamp((started_at)*1000l,\"yyyy-MM-dd HH:mm:ss\"),",
				"          ended_at = toTimestamp((ended_at)*1000l,\"yyyy-MM-dd HH:mm:ss\"),",
				"          processdate = currentUTC(),",
				"          duration = toInteger(duration),",
				"          id = toString(id),",
				"          transferred_by_ring_timeout = toInteger(transferred_by_ring_timeout),",
				"     partitionBy('hash', 1)) ~> derivedColumn1",
				"derivedColumn1 alterRow(upsertIf(true()),",
				"     partitionBy('hash', 1)) ~> alterRow1",
				"alterRow1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'delta',",
				"     fileSystem: 'silver',",
				"     folderPath: 'lakehousef0/aircallcalls',",
				"     mergeSchema: false,",
				"     autoCompact: false,",
				"     optimizedWrite: false,",
				"     vacuum: 0,",
				"     deletable: false,",
				"     insertable: false,",
				"     updateable: false,",
				"     upsertable: true,",
				"     keys:['id'],",
				"     umask: 0022,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> sinkAircallSilver"
			]
		}
	}
}